

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Software Interface &#8212; pmacFilterControl 0.1 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/design-tabs.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'explanations/interface';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Developer Guide" href="../how-to/index.html" />
    <link rel="prev" title="Overview" href="overview.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  <div class="navbar-header-items__start">
    
      <div class="navbar-item">
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/dls-logo.svg" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/dls-logo.svg" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
    <p class="title logo__title">pmacFilterControl</p>
  
</a></div>
    
  </div>
  
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="overview.html">
                        Overview
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../how-to/index.html">
                        Developer Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../reference/index.html">
                        Reference
                      </a>
                    </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
        </div>
      
      
        <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/dls-controls/pmacFilterControl" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="overview.html">
                        Overview
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../how-to/index.html">
                        Developer Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../reference/index.html">
                        Reference
                      </a>
                    </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/dls-controls/pmacFilterControl" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item"><nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Software Interface</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumbs">
  <ul class="bd-breadcrumbs" role="navigation" aria-label="Breadcrumb">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="overview.html" class="nav-link">Overview</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">Software Interface</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="software-interface">
<h1>Software Interface<a class="headerlink" href="#software-interface" title="Permalink to this heading">#</a></h1>
<p>This page describes the software interface of the pmacFilterControl application.</p>
<section id="control-channel">
<h2>Control Channel<a class="headerlink" href="#control-channel" title="Permalink to this heading">#</a></h2>
<p>A ZMQ control channel is exposed on the port given in the CLI parameters. The requests
that can be sent to this channel are detailed below.</p>
<section id="commands">
<h3>Commands<a class="headerlink" href="#commands" title="Permalink to this heading">#</a></h3>
<p>All messages must have a <code class="docutils literal notranslate"><span class="pre">command</span></code> key. Valid commands are:</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head text-right"><p>Command</p></th>
<th class="head text-left"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-right"><p>shutdown</p></td>
<td class="text-left"><p>Shutdown the application</p></td>
</tr>
<tr class="row-odd"><td class="text-right"><p>status</p></td>
<td class="text-left"><p>Request a status message</p></td>
</tr>
<tr class="row-even"><td class="text-right"><p>configure</p></td>
<td class="text-left"><p>Configure parameters</p></td>
</tr>
<tr class="row-odd"><td class="text-right"><p>reset</p></td>
<td class="text-left"><p>Reset the <code class="docutils literal notranslate"><span class="pre">last_*_frame</span></code> counters - this is required to begin processing frame numbers from 0 again</p></td>
</tr>
<tr class="row-even"><td class="text-right"><p>clear_timeout</p></td>
<td class="text-left"><p>Clear the <code class="docutils literal notranslate"><span class="pre">TIMEOUT</span></code> state and change into the <code class="docutils literal notranslate"><span class="pre">WAITING</span></code> state</p></td>
</tr>
<tr class="row-odd"><td class="text-right"><p>singleshot</p></td>
<td class="text-left"><p>Request a singleshot run to start - must be in <code class="docutils literal notranslate"><span class="pre">SINGLESHOT</span></code> mode and <code class="docutils literal notranslate"><span class="pre">WAITING</span></code> state</p></td>
</tr>
</tbody>
</table>
<p>For example:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="nt">&quot;command&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;shutdown&quot;</span><span class="p">}</span>
</pre></div>
</div>
</section>
<section id="config">
<h3>Config<a class="headerlink" href="#config" title="Permalink to this heading">#</a></h3>
<p>The configuration requests are exposed via the <code class="docutils literal notranslate"><span class="pre">config</span></code> command request. Config
requests must contain a <code class="docutils literal notranslate"><span class="pre">params</span></code> key and its value must be a dictionary with at least
one of the following config options:</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head text-right"><p>Config</p></th>
<th class="head text-left"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-right"><p>mode</p></td>
<td class="text-left"><p>Set the operational mode - 0: Disable, 1: Continuous, 2: Singleshot</p></td>
</tr>
<tr class="row-odd"><td class="text-right"><p>in_positions</p></td>
<td class="text-left"><p>In positions (counts) for each filter - allowed keys: <code class="docutils literal notranslate"><span class="pre">&quot;filter{1,2,3,4}&quot;</span></code></p></td>
</tr>
<tr class="row-even"><td class="text-right"><p>out_positions</p></td>
<td class="text-left"><p>Out positions (counts) for each filter - allowed keys: <code class="docutils literal notranslate"><span class="pre">&quot;filter{1,2,3,4}&quot;</span></code></p></td>
</tr>
<tr class="row-odd"><td class="text-right"><p>pixel_count_thresholds</p></td>
<td class="text-left"><p>Thresholds for each histogram bin above which attenuation should be changed - allowed keys: threshold names, e.g.: <code class="docutils literal notranslate"><span class="pre">&quot;low1&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;high2&quot;</span></code></p></td>
</tr>
</tbody>
</table>
<p>For example:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="nt">&quot;command&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;configure&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;params&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;mode&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">}}</span>
</pre></div>
</div>
</section>
<section id="status">
<h3>Status<a class="headerlink" href="#status" title="Permalink to this heading">#</a></h3>
<p>A dictionary of the current status can be requested with the <code class="docutils literal notranslate"><span class="pre">status</span></code> command. The
following status items are included in response:</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head text-right"><p>Status</p></th>
<th class="head text-left"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-right"><p>version</p></td>
<td class="text-left"><p>The version number of the application</p></td>
</tr>
<tr class="row-odd"><td class="text-right"><p>process_duration</p></td>
<td class="text-left"><p>The duration of the most recent process that changed the attenuation (us)</p></td>
</tr>
<tr class="row-even"><td class="text-right"><p>process_period</p></td>
<td class="text-left"><p>The elapsed time between the most recent process and the preceding one (us)</p></td>
</tr>
<tr class="row-odd"><td class="text-right"><p>last_received_frame</p></td>
<td class="text-left"><p>The frame number of the most recently received data message</p></td>
</tr>
<tr class="row-even"><td class="text-right"><p>last_processed_frame</p></td>
<td class="text-left"><p>The frame number of the most recently received data message that caused the attenuation to change</p></td>
</tr>
<tr class="row-odd"><td class="text-right"><p>time_since_last_message</p></td>
<td class="text-left"><p>The elapsed time since a message was last received</p></td>
</tr>
<tr class="row-even"><td class="text-right"><p>current_attenuation</p></td>
<td class="text-left"><p>The currently demanded attenuation level</p></td>
</tr>
<tr class="row-odd"><td class="text-right"><p>state</p></td>
<td class="text-left"><p>The current state - 0: Idle, 1: Waiting, 2: Active, 3: Timeout, 4: Singleshot Complete</p></td>
</tr>
</tbody>
</table>
<p>For example:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="nt">&quot;command&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;status&quot;</span><span class="p">}</span>
</pre></div>
</div>
<p>Readbacks for <a class="reference internal" href="#config">config items</a> are included in the response with the same keys as
in the config command request.</p>
</section>
<section id="timeout-state">
<h3>Timeout State<a class="headerlink" href="#timeout-state" title="Permalink to this heading">#</a></h3>
<p>If frames are not received for 3 seconds while in the <code class="docutils literal notranslate"><span class="pre">ACTIVE</span></code> state then the <code class="docutils literal notranslate"><span class="pre">TIMEOUT</span></code>
state is triggered. When this happens maximum attenuation is set and any further data
messages are ignored. The <code class="docutils literal notranslate"><span class="pre">clear_timeout</span></code> command must be sent, which will clear the
error and change the state to <code class="docutils literal notranslate"><span class="pre">WAITING</span></code>.</p>
<p>This logic is a failsafe to minimise the time that attenuation is kept below the maximum
without receiving data messages to continually confirm that the attenuation is safe.</p>
</section>
<section id="singleshot-mode">
<h3>Singleshot Mode<a class="headerlink" href="#singleshot-mode" title="Permalink to this heading">#</a></h3>
<p>If the system is put into <code class="docutils literal notranslate"><span class="pre">SINGLESHOT</span></code> mode, maximum attenuation is set and the
<code class="docutils literal notranslate"><span class="pre">WAITING</span></code> state is entered until data messages are received on the subscribe channel.
Once data messages start, the system adjusts attenuation as normal until a message is
received that does not cause an adjustment. At this point the attenuation level is
considered stable and the <code class="docutils literal notranslate"><span class="pre">SINGLESHOT_COMPELETE</span></code> state is entered, which pauses the
adjustment at the current attenuation level without timing out. Max attenuation will
only be set at the beginning of the first run, or if an error state is entered. Between
runs, the attenuation will be kept at the previously stable value.</p>
<p>This mode allows higher level software to use the automatic attenuation to optimise the
attenuation level and then capture a single optimal image at that attenuation.</p>
</section>
</section>
<section id="data-channel">
<h2>Data Channel<a class="headerlink" href="#data-channel" title="Permalink to this heading">#</a></h2>
<p>The application will subscribe on the endpoints given in the CLI parameters. Messages of
the following form are expected on these channels:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;frame_number&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;parameters&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;low2&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;low1&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;high1&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">17</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;high2&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;high3&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">pixel_count_thresholds</span></code> for each of these bins determine the action taken for
received data messages. The low thresholds are triggered if there are not enough pixels
above the given value, while the high thresholds are triggered if there are too many.</p>
<p>Any messages with a <code class="docutils literal notranslate"><span class="pre">frame_number</span></code> less than <code class="docutils literal notranslate"><span class="pre">last_processed_frame</span></code> will be ignored -
because it is too late to correct for them - as will frames equal to
<code class="docutils literal notranslate"><span class="pre">last_processed_frame</span> <span class="pre">+</span> <span class="pre">1</span></code> - because the change from the previous message will not have
taken effect yet and adjusting for the subsequent message would be correcting a second
time for the same event.</p>
</section>
<section id="event-stream-channel">
<h2>Event Stream Channel<a class="headerlink" href="#event-stream-channel" title="Permalink to this heading">#</a></h2>
<p>For each successfully processed data message, an event message will be published on the
event stream channel. The channel will be bound to the publish port given in the CLI
parameters. The messages will be of the form (where frame 6 caused an adjustment of -1):</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;frame_number&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;adjustment&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;attenuation&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span>
<span class="p">}</span>
<span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;frame_number&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;adjustment&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;attenuation&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span>
<span class="p">}</span>
</pre></div>
</div>
<p>It is intended for a higher-level application to subscribe to these events in order to
record the the active attenuation level for each frame and whether the adjustment
triggered. The <code class="docutils literal notranslate"><span class="pre">adjustment</span></code> and <code class="docutils literal notranslate"><span class="pre">attenuation</span></code> of frame <code class="docutils literal notranslate"><span class="pre">N+1</span></code> will be that which
resulted from processing frame <code class="docutils literal notranslate"><span class="pre">N</span></code>. A non-zero adjustment for frame <code class="docutils literal notranslate"><span class="pre">N+1</span></code> means the
attenuation was not optimal for frame <code class="docutils literal notranslate"><span class="pre">N</span></code> and will be changed during the exposure of
frame <code class="docutils literal notranslate"><span class="pre">N+1</span></code>, which means data analysis needs to ignore the data from that frame because
it is undefined what the exposure was.</p>
</section>
<section id="motion-program">
<h2>Motion Program<a class="headerlink" href="#motion-program" title="Permalink to this heading">#</a></h2>
<p>The motion program simply commands two moves in quick succession, with a timer to
estimate how long the moves took. The first move will demand the filters 1, 2, 3, 4 to
the positions stored in <code class="docutils literal notranslate"><span class="pre">P407{1,2,3,4}</span></code> and for the second move <code class="docutils literal notranslate"><span class="pre">P408{1,2,3,4}</span></code>. These
values are written to by the pmacFilterControl application before running the program.
The time elapsed is stored in <code class="docutils literal notranslate"><span class="pre">P4085</span></code>.</p>
</section>
</section>


                </article>
              
              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="overview.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Overview</p>
      </div>
    </a>
    <a class="right-next"
       href="../how-to/index.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Developer Guide</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#control-channel">Control Channel</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#commands">Commands</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#config">Config</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#status">Status</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#timeout-state">Timeout State</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#singleshot-mode">Singleshot Mode</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-channel">Data Channel</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#event-stream-channel">Event Stream Channel</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#motion-program">Motion Program</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.13.3.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>